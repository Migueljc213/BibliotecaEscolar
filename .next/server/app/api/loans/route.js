"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/loans/route";
exports.ids = ["app/api/loans/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Floans%2Froute&page=%2Fapi%2Floans%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Floans%2Froute.ts&appDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Floans%2Froute&page=%2Fapi%2Floans%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Floans%2Froute.ts&appDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Miguel_projetos_biblioteca_src_app_api_loans_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/loans/route.ts */ \"(rsc)/./src/app/api/loans/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/loans/route\",\n        pathname: \"/api/loans\",\n        filename: \"route\",\n        bundlePath: \"app/api/loans/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Miguel\\\\projetos\\\\biblioteca\\\\src\\\\app\\\\api\\\\loans\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Miguel_projetos_biblioteca_src_app_api_loans_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/loans/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZsb2FucyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGbG9hbnMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZsb2FucyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNNaWd1ZWwlNUNwcm9qZXRvcyU1Q2JpYmxpb3RlY2ElNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q01pZ3VlbCU1Q3Byb2pldG9zJTVDYmlibGlvdGVjYSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDdUI7QUFDcEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iaWJsaW90ZWNhLWVzY29sYXIvPzQ1MmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcTWlndWVsXFxcXHByb2pldG9zXFxcXGJpYmxpb3RlY2FcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcbG9hbnNcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2xvYW5zL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvbG9hbnNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2xvYW5zL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcTWlndWVsXFxcXHByb2pldG9zXFxcXGJpYmxpb3RlY2FcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcbG9hbnNcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2xvYW5zL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Floans%2Froute&page=%2Fapi%2Floans%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Floans%2Froute.ts&appDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/loans/route.ts":
/*!************************************!*\
  !*** ./src/app/api/loans/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_services_loans__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/services/loans */ \"(rsc)/./src/lib/services/loans.ts\");\n\n\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const search = searchParams.get(\"search\") || undefined;\n        const status = searchParams.get(\"status\") || undefined;\n        const period = searchParams.get(\"period\") || undefined;\n        const loans = await _lib_services_loans__WEBPACK_IMPORTED_MODULE_1__.LoanService.getLoansByFilters({\n            search,\n            status: status,\n            period\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(loans);\n    } catch (error) {\n        console.error(\"Erro ao buscar empr\\xe9stimos:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Erro interno do servidor\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        // Converter a data de vencimento para Date\n        const loanData = {\n            ...body,\n            dueDate: new Date(body.dueDate)\n        };\n        const loan = await _lib_services_loans__WEBPACK_IMPORTED_MODULE_1__.LoanService.createLoan(loanData);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(loan, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"Erro ao criar empr\\xe9stimo:\", error);\n        // Se é um erro conhecido com mensagem específica\n        if (error.message) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: error.message\n            }, {\n                status: 400\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Erro interno do servidor\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9sb2Fucy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVEO0FBQ0w7QUFFM0MsZUFBZUUsSUFBSUMsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSUYsUUFBUUcsR0FBRztRQUM1QyxNQUFNQyxTQUFTSCxhQUFhSSxHQUFHLENBQUMsYUFBYUM7UUFDN0MsTUFBTUMsU0FBU04sYUFBYUksR0FBRyxDQUFDLGFBQWFDO1FBQzdDLE1BQU1FLFNBQVNQLGFBQWFJLEdBQUcsQ0FBQyxhQUFhQztRQUU3QyxNQUFNRyxRQUFRLE1BQU1YLDREQUFXQSxDQUFDWSxpQkFBaUIsQ0FBQztZQUNoRE47WUFDQUcsUUFBUUE7WUFDUkM7UUFDRjtRQUVBLE9BQU9YLHFEQUFZQSxDQUFDYyxJQUFJLENBQUNGO0lBQzNCLEVBQUUsT0FBT0csT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsa0NBQStCQTtRQUM3QyxPQUFPZixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQTJCLEdBQ3BDO1lBQUVMLFFBQVE7UUFBSTtJQUVsQjtBQUNGO0FBRU8sZUFBZU8sS0FBS2QsT0FBb0I7SUFDN0MsSUFBSTtRQUNGLE1BQU1lLE9BQU8sTUFBTWYsUUFBUVcsSUFBSTtRQUUvQiwyQ0FBMkM7UUFDM0MsTUFBTUssV0FBVztZQUNmLEdBQUdELElBQUk7WUFDUEUsU0FBUyxJQUFJQyxLQUFLSCxLQUFLRSxPQUFPO1FBQ2hDO1FBRUEsTUFBTUUsT0FBTyxNQUFNckIsNERBQVdBLENBQUNzQixVQUFVLENBQUNKO1FBQzFDLE9BQU9uQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUFDUSxNQUFNO1lBQUVaLFFBQVE7UUFBSTtJQUMvQyxFQUFFLE9BQU9LLE9BQVk7UUFDbkJDLFFBQVFELEtBQUssQ0FBQyxnQ0FBNkJBO1FBRTNDLGlEQUFpRDtRQUNqRCxJQUFJQSxNQUFNUyxPQUFPLEVBQUU7WUFDakIsT0FBT3hCLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPQSxNQUFNUyxPQUFPO1lBQUMsR0FDdkI7Z0JBQUVkLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE9BQU9WLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBMkIsR0FDcEM7WUFBRUwsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iaWJsaW90ZWNhLWVzY29sYXIvLi9zcmMvYXBwL2FwaS9sb2Fucy9yb3V0ZS50cz81NzhkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcclxuaW1wb3J0IHsgTG9hblNlcnZpY2UgfSBmcm9tICdAL2xpYi9zZXJ2aWNlcy9sb2FucydcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpXHJcbiAgICBjb25zdCBzZWFyY2ggPSBzZWFyY2hQYXJhbXMuZ2V0KCdzZWFyY2gnKSB8fCB1bmRlZmluZWRcclxuICAgIGNvbnN0IHN0YXR1cyA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpIHx8IHVuZGVmaW5lZFxyXG4gICAgY29uc3QgcGVyaW9kID0gc2VhcmNoUGFyYW1zLmdldCgncGVyaW9kJykgfHwgdW5kZWZpbmVkXHJcblxyXG4gICAgY29uc3QgbG9hbnMgPSBhd2FpdCBMb2FuU2VydmljZS5nZXRMb2Fuc0J5RmlsdGVycyh7XHJcbiAgICAgIHNlYXJjaCxcclxuICAgICAgc3RhdHVzOiBzdGF0dXMgYXMgYW55LFxyXG4gICAgICBwZXJpb2RcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGxvYW5zKVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIGJ1c2NhciBlbXByw6lzdGltb3M6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6ICdFcnJvIGludGVybm8gZG8gc2Vydmlkb3InIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXHJcbiAgICBcclxuICAgIC8vIENvbnZlcnRlciBhIGRhdGEgZGUgdmVuY2ltZW50byBwYXJhIERhdGVcclxuICAgIGNvbnN0IGxvYW5EYXRhID0ge1xyXG4gICAgICAuLi5ib2R5LFxyXG4gICAgICBkdWVEYXRlOiBuZXcgRGF0ZShib2R5LmR1ZURhdGUpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IGxvYW4gPSBhd2FpdCBMb2FuU2VydmljZS5jcmVhdGVMb2FuKGxvYW5EYXRhKVxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGxvYW4sIHsgc3RhdHVzOiAyMDEgfSlcclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIGNyaWFyIGVtcHLDqXN0aW1vOicsIGVycm9yKVxyXG4gICAgXHJcbiAgICAvLyBTZSDDqSB1bSBlcnJvIGNvbmhlY2lkbyBjb20gbWVuc2FnZW0gZXNwZWPDrWZpY2FcclxuICAgIGlmIChlcnJvci5tZXNzYWdlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgIClcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiAnRXJybyBpbnRlcm5vIGRvIHNlcnZpZG9yJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgIClcclxuICB9XHJcbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkxvYW5TZXJ2aWNlIiwiR0VUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInNlYXJjaCIsImdldCIsInVuZGVmaW5lZCIsInN0YXR1cyIsInBlcmlvZCIsImxvYW5zIiwiZ2V0TG9hbnNCeUZpbHRlcnMiLCJqc29uIiwiZXJyb3IiLCJjb25zb2xlIiwiUE9TVCIsImJvZHkiLCJsb2FuRGF0YSIsImR1ZURhdGUiLCJEYXRlIiwibG9hbiIsImNyZWF0ZUxvYW4iLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/loans/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNkM7QUFFN0MsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsR0FBRTtBQUVsRSxJQUFJSSxJQUF5QixFQUFjSCxnQkFBZ0JFLE1BQU0sR0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iaWJsaW90ZWNhLWVzY29sYXIvLi9zcmMvbGliL3ByaXNtYS50cz8wMWQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50J1xyXG5cclxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcclxuICBwcmlzbWE6IFByaXNtYUNsaWVudCB8IHVuZGVmaW5lZFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcHJpc21hID0gZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA/PyBuZXcgUHJpc21hQ2xpZW50KClcclxuXHJcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hICJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/audit.ts":
/*!***********************************!*\
  !*** ./src/lib/services/audit.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuditService: () => (/* binding */ AuditService)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\nclass AuditService {\n    // Criar log de auditoria\n    static async createAuditLog(data) {\n        // Verificar se já existe um log similar recente (últimos 5 segundos) para evitar duplicatas\n        const recentLog = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.findFirst({\n            where: {\n                bookId: data.bookId,\n                action: data.action,\n                description: data.description,\n                createdAt: {\n                    gte: new Date(Date.now() - 5000) // Últimos 5 segundos\n                }\n            }\n        });\n        if (recentLog) {\n            console.log(\"Log similar j\\xe1 existe, evitando duplicata:\", data.description);\n            return recentLog;\n        }\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.create({\n            data,\n            include: {\n                book: {\n                    select: {\n                        code: true,\n                        title: true\n                    }\n                }\n            }\n        });\n    }\n    // Buscar logs de auditoria por livro\n    static async getAuditLogsByBook(bookId) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.findMany({\n            where: {\n                bookId\n            },\n            include: {\n                book: {\n                    select: {\n                        code: true,\n                        title: true\n                    }\n                }\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            }\n        });\n    }\n    // Buscar todos os logs de auditoria\n    static async getAllAuditLogs(limit = 100) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.findMany({\n            include: {\n                book: {\n                    select: {\n                        code: true,\n                        title: true\n                    }\n                }\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            take: limit\n        });\n    }\n    // Buscar logs por ação\n    static async getAuditLogsByAction(action, limit = 50) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.findMany({\n            where: {\n                action\n            },\n            include: {\n                book: {\n                    select: {\n                        code: true,\n                        title: true\n                    }\n                }\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            take: limit\n        });\n    }\n    // Buscar logs por período\n    static async getAuditLogsByPeriod(startDate, endDate) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.findMany({\n            where: {\n                createdAt: {\n                    gte: startDate,\n                    lte: endDate\n                }\n            },\n            include: {\n                book: {\n                    select: {\n                        code: true,\n                        title: true\n                    }\n                }\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            }\n        });\n    }\n    // Buscar estatísticas de auditoria\n    static async getAuditStats() {\n        const totalLogs = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.count();\n        const logsByAction = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.groupBy({\n            by: [\n                \"action\"\n            ],\n            _count: {\n                action: true\n            }\n        });\n        const recentLogs = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.bookAuditLog.count({\n            where: {\n                createdAt: {\n                    gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000) // Últimos 30 dias\n                }\n            }\n        });\n        return {\n            totalLogs,\n            recentLogs,\n            logsByAction: logsByAction.map((log)=>({\n                    action: log.action,\n                    count: log._count.action\n                }))\n        };\n    }\n    // Log de criação de livro\n    static async logBookCreation(bookId, bookData, userId) {\n        return await this.createAuditLog({\n            bookId,\n            action: \"CREATE\",\n            description: `Livro \"${bookData.title}\" (${bookData.code}) foi cadastrado no sistema`,\n            userId\n        });\n    }\n    // Log de atualização de livro\n    static async logBookUpdate(bookId, fieldName, oldValue, newValue, userId) {\n        const book = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findUnique({\n            where: {\n                id: bookId\n            },\n            select: {\n                code: true,\n                title: true\n            }\n        });\n        return await this.createAuditLog({\n            bookId,\n            action: \"UPDATE\",\n            fieldName,\n            oldValue: String(oldValue),\n            newValue: String(newValue),\n            description: `Campo \"${fieldName}\" do livro \"${book?.title}\" (${book?.code}) foi alterado`,\n            userId\n        });\n    }\n    // Log de exclusão de livro\n    static async logBookDeletion(bookId, bookData, userId) {\n        return await this.createAuditLog({\n            bookId,\n            action: \"DELETE\",\n            description: `Livro \"${bookData.title}\" (${bookData.code}) foi removido do sistema`,\n            userId\n        });\n    }\n    // Log de restauração de livro\n    static async logBookRestoration(bookId, bookData, userId) {\n        return await this.createAuditLog({\n            bookId,\n            action: \"RESTORE\",\n            description: `Livro \"${bookData.title}\" (${bookData.code}) foi restaurado no sistema`,\n            userId\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWMsQ0FBQztZQUMxRndCO1FBQ0Y7SUFDRjtJQUVBLDJCQUEyQjtJQUMzQixhQUFhUSxnQkFBZ0I3QyxNQUFjLEVBQUVvQyxRQUFhLEVBQUVDLE1BQWUsRUFBRTtRQUMzRSxPQUFPLE1BQU0sSUFBSSxDQUFDM0MsY0FBYyxDQUFDO1lBQy9CTTtZQUNBQyxRQUFRO1lBQ1JDLGFBQWEsQ0FBQyxPQUFPLEVBQUVrQyxTQUFTdEIsS0FBSyxDQUFDLEdBQUcsRUFBRXNCLFNBQVN2QixJQUFJLENBQUMseUJBQXlCLENBQUM7WUFDbkZ3QjtRQUNGO0lBQ0Y7SUFFQSw4QkFBOEI7SUFDOUIsYUFBYVMsbUJBQW1COUMsTUFBYyxFQUFFb0MsUUFBYSxFQUFFQyxNQUFlLEVBQUU7UUFDOUUsT0FBTyxNQUFNLElBQUksQ0FBQzNDLGNBQWMsQ0FBQztZQUMvQk07WUFDQUMsUUFBUTtZQUNSQyxhQUFhLENBQUMsT0FBTyxFQUFFa0MsU0FBU3RCLEtBQUssQ0FBQyxHQUFHLEVBQUVzQixTQUFTdkIsSUFBSSxDQUFDLDJCQUEyQixDQUFDO1lBQ3JGd0I7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iaWJsaW90ZWNhLWVzY29sYXIvLi9zcmMvbGliL3NlcnZpY2VzL2F1ZGl0LnRzPzUyMTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vcHJpc21hJ1xyXG5cclxudHlwZSBBdWRpdEFjdGlvbiA9ICdDUkVBVEUnIHwgJ1VQREFURScgfCAnREVMRVRFJyB8ICdSRVNUT1JFJ1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBdWRpdExvZ0RhdGEge1xyXG4gIGJvb2tJZDogc3RyaW5nXHJcbiAgYWN0aW9uOiBBdWRpdEFjdGlvblxyXG4gIGZpZWxkTmFtZT86IHN0cmluZ1xyXG4gIG9sZFZhbHVlPzogc3RyaW5nXHJcbiAgbmV3VmFsdWU/OiBzdHJpbmdcclxuICBkZXNjcmlwdGlvbjogc3RyaW5nXHJcbiAgdXNlcklkPzogc3RyaW5nXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBdWRpdFNlcnZpY2Uge1xyXG4gIC8vIENyaWFyIGxvZyBkZSBhdWRpdG9yaWFcclxuICBzdGF0aWMgYXN5bmMgY3JlYXRlQXVkaXRMb2coZGF0YTogQ3JlYXRlQXVkaXRMb2dEYXRhKSB7XHJcbiAgICAvLyBWZXJpZmljYXIgc2UgasOhIGV4aXN0ZSB1bSBsb2cgc2ltaWxhciByZWNlbnRlICjDumx0aW1vcyA1IHNlZ3VuZG9zKSBwYXJhIGV2aXRhciBkdXBsaWNhdGFzXHJcbiAgICBjb25zdCByZWNlbnRMb2cgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9va0F1ZGl0TG9nLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgYm9va0lkOiBkYXRhLmJvb2tJZCxcclxuICAgICAgICBhY3Rpb246IGRhdGEuYWN0aW9uLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgIGNyZWF0ZWRBdDoge1xyXG4gICAgICAgICAgZ3RlOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNTAwMCkgLy8gw5psdGltb3MgNSBzZWd1bmRvc1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBpZiAocmVjZW50TG9nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdMb2cgc2ltaWxhciBqw6EgZXhpc3RlLCBldml0YW5kbyBkdXBsaWNhdGE6JywgZGF0YS5kZXNjcmlwdGlvbilcclxuICAgICAgcmV0dXJuIHJlY2VudExvZ1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9va0F1ZGl0TG9nLmNyZWF0ZSh7XHJcbiAgICAgIGRhdGEsXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBib29rOiB7XHJcbiAgICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgICAgY29kZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBCdXNjYXIgbG9ncyBkZSBhdWRpdG9yaWEgcG9yIGxpdnJvXHJcbiAgc3RhdGljIGFzeW5jIGdldEF1ZGl0TG9nc0J5Qm9vayhib29rSWQ6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGF3YWl0IChwcmlzbWEgYXMgYW55KS5ib29rQXVkaXRMb2cuZmluZE1hbnkoe1xyXG4gICAgICB3aGVyZTogeyBib29rSWQgfSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIGJvb2s6IHtcclxuICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICBjb2RlOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXRsZTogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLy8gQnVzY2FyIHRvZG9zIG9zIGxvZ3MgZGUgYXVkaXRvcmlhXHJcbiAgc3RhdGljIGFzeW5jIGdldEFsbEF1ZGl0TG9ncyhsaW1pdDogbnVtYmVyID0gMTAwKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgKHByaXNtYSBhcyBhbnkpLmJvb2tBdWRpdExvZy5maW5kTWFueSh7XHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBib29rOiB7XHJcbiAgICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgICAgY29kZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcclxuICAgICAgdGFrZTogbGltaXRcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBCdXNjYXIgbG9ncyBwb3IgYcOnw6NvXHJcbiAgc3RhdGljIGFzeW5jIGdldEF1ZGl0TG9nc0J5QWN0aW9uKGFjdGlvbjogQXVkaXRBY3Rpb24sIGxpbWl0OiBudW1iZXIgPSA1MCkge1xyXG4gICAgcmV0dXJuIGF3YWl0IChwcmlzbWEgYXMgYW55KS5ib29rQXVkaXRMb2cuZmluZE1hbnkoe1xyXG4gICAgICB3aGVyZTogeyBhY3Rpb24gfSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIGJvb2s6IHtcclxuICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICBjb2RlOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXRsZTogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxyXG4gICAgICB0YWtlOiBsaW1pdFxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIEJ1c2NhciBsb2dzIHBvciBwZXLDrW9kb1xyXG4gIHN0YXRpYyBhc3luYyBnZXRBdWRpdExvZ3NCeVBlcmlvZChzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpIHtcclxuICAgIHJldHVybiBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9va0F1ZGl0TG9nLmZpbmRNYW55KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBjcmVhdGVkQXQ6IHtcclxuICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxyXG4gICAgICAgICAgbHRlOiBlbmREYXRlXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgYm9vazoge1xyXG4gICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgIGNvZGU6IHRydWUsXHJcbiAgICAgICAgICAgIHRpdGxlOiB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBCdXNjYXIgZXN0YXTDrXN0aWNhcyBkZSBhdWRpdG9yaWFcclxuICBzdGF0aWMgYXN5bmMgZ2V0QXVkaXRTdGF0cygpIHtcclxuICAgIGNvbnN0IHRvdGFsTG9ncyA9IGF3YWl0IChwcmlzbWEgYXMgYW55KS5ib29rQXVkaXRMb2cuY291bnQoKVxyXG4gICAgXHJcbiAgICBjb25zdCBsb2dzQnlBY3Rpb24gPSBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9va0F1ZGl0TG9nLmdyb3VwQnkoe1xyXG4gICAgICBieTogWydhY3Rpb24nXSxcclxuICAgICAgX2NvdW50OiB7IGFjdGlvbjogdHJ1ZSB9XHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnN0IHJlY2VudExvZ3MgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9va0F1ZGl0TG9nLmNvdW50KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBjcmVhdGVkQXQ6IHtcclxuICAgICAgICAgIGd0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCkgLy8gw5psdGltb3MgMzAgZGlhc1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbExvZ3MsXHJcbiAgICAgIHJlY2VudExvZ3MsXHJcbiAgICAgIGxvZ3NCeUFjdGlvbjogbG9nc0J5QWN0aW9uLm1hcCgobG9nOiBhbnkpID0+ICh7XHJcbiAgICAgICAgYWN0aW9uOiBsb2cuYWN0aW9uLFxyXG4gICAgICAgIGNvdW50OiBsb2cuX2NvdW50LmFjdGlvblxyXG4gICAgICB9KSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIExvZyBkZSBjcmlhw6fDo28gZGUgbGl2cm9cclxuICBzdGF0aWMgYXN5bmMgbG9nQm9va0NyZWF0aW9uKGJvb2tJZDogc3RyaW5nLCBib29rRGF0YTogYW55LCB1c2VySWQ/OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNyZWF0ZUF1ZGl0TG9nKHtcclxuICAgICAgYm9va0lkLFxyXG4gICAgICBhY3Rpb246ICdDUkVBVEUnLFxyXG4gICAgICBkZXNjcmlwdGlvbjogYExpdnJvIFwiJHtib29rRGF0YS50aXRsZX1cIiAoJHtib29rRGF0YS5jb2RlfSkgZm9pIGNhZGFzdHJhZG8gbm8gc2lzdGVtYWAsXHJcbiAgICAgIHVzZXJJZFxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIExvZyBkZSBhdHVhbGl6YcOnw6NvIGRlIGxpdnJvXHJcbiAgc3RhdGljIGFzeW5jIGxvZ0Jvb2tVcGRhdGUoYm9va0lkOiBzdHJpbmcsIGZpZWxkTmFtZTogc3RyaW5nLCBvbGRWYWx1ZTogYW55LCBuZXdWYWx1ZTogYW55LCB1c2VySWQ/OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGJvb2sgPSBhd2FpdCAocHJpc21hIGFzIGFueSkuYm9vay5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGJvb2tJZCB9LFxyXG4gICAgICBzZWxlY3Q6IHsgY29kZTogdHJ1ZSwgdGl0bGU6IHRydWUgfVxyXG4gICAgfSlcclxuXHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jcmVhdGVBdWRpdExvZyh7XHJcbiAgICAgIGJvb2tJZCxcclxuICAgICAgYWN0aW9uOiAnVVBEQVRFJyxcclxuICAgICAgZmllbGROYW1lLFxyXG4gICAgICBvbGRWYWx1ZTogU3RyaW5nKG9sZFZhbHVlKSxcclxuICAgICAgbmV3VmFsdWU6IFN0cmluZyhuZXdWYWx1ZSksXHJcbiAgICAgIGRlc2NyaXB0aW9uOiBgQ2FtcG8gXCIke2ZpZWxkTmFtZX1cIiBkbyBsaXZybyBcIiR7Ym9vaz8udGl0bGV9XCIgKCR7Ym9vaz8uY29kZX0pIGZvaSBhbHRlcmFkb2AsXHJcbiAgICAgIHVzZXJJZFxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIExvZyBkZSBleGNsdXPDo28gZGUgbGl2cm9cclxuICBzdGF0aWMgYXN5bmMgbG9nQm9va0RlbGV0aW9uKGJvb2tJZDogc3RyaW5nLCBib29rRGF0YTogYW55LCB1c2VySWQ/OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNyZWF0ZUF1ZGl0TG9nKHtcclxuICAgICAgYm9va0lkLFxyXG4gICAgICBhY3Rpb246ICdERUxFVEUnLFxyXG4gICAgICBkZXNjcmlwdGlvbjogYExpdnJvIFwiJHtib29rRGF0YS50aXRsZX1cIiAoJHtib29rRGF0YS5jb2RlfSkgZm9pIHJlbW92aWRvIGRvIHNpc3RlbWFgLFxyXG4gICAgICB1c2VySWRcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBMb2cgZGUgcmVzdGF1cmHDp8OjbyBkZSBsaXZyb1xyXG4gIHN0YXRpYyBhc3luYyBsb2dCb29rUmVzdG9yYXRpb24oYm9va0lkOiBzdHJpbmcsIGJvb2tEYXRhOiBhbnksIHVzZXJJZD86IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlQXVkaXRMb2coe1xyXG4gICAgICBib29rSWQsXHJcbiAgICAgIGFjdGlvbjogJ1JFU1RPUkUnLFxyXG4gICAgICBkZXNjcmlwdGlvbjogYExpdnJvIFwiJHtib29rRGF0YS50aXRsZX1cIiAoJHtib29rRGF0YS5jb2RlfSkgZm9pIHJlc3RhdXJhZG8gbm8gc2lzdGVtYWAsXHJcbiAgICAgIHVzZXJJZFxyXG4gICAgfSlcclxuICB9XHJcbn0gIl0sIm5hbWVzIjpbInByaXNtYSIsIkF1ZGl0U2VydmljZSIsImNyZWF0ZUF1ZGl0TG9nIiwiZGF0YSIsInJlY2VudExvZyIsImJvb2tBdWRpdExvZyIsImZpbmRGaXJzdCIsIndoZXJlIiwiYm9va0lkIiwiYWN0aW9uIiwiZGVzY3JpcHRpb24iLCJjcmVhdGVkQXQiLCJndGUiLCJEYXRlIiwibm93IiwiY29uc29sZSIsImxvZyIsImNyZWF0ZSIsImluY2x1ZGUiLCJib29rIiwic2VsZWN0IiwiY29kZSIsInRpdGxlIiwiZ2V0QXVkaXRMb2dzQnlCb29rIiwiZmluZE1hbnkiLCJvcmRlckJ5IiwiZ2V0QWxsQXVkaXRMb2dzIiwibGltaXQiLCJ0YWtlIiwiZ2V0QXVkaXRMb2dzQnlBY3Rpb24iLCJnZXRBdWRpdExvZ3NCeVBlcmlvZCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJsdGUiLCJnZXRBdWRpdFN0YXRzIiwidG90YWxMb2dzIiwiY291bnQiLCJsb2dzQnlBY3Rpb24iLCJncm91cEJ5IiwiYnkiLCJfY291bnQiLCJyZWNlbnRMb2dzIiwibWFwIiwibG9nQm9va0NyZWF0aW9uIiwiYm9va0RhdGEiLCJ1c2VySWQiLCJsb2dCb29rVXBkYXRlIiwiZmllbGROYW1lIiwib2xkVmFsdWUiLCJuZXdWYWx1ZSIsImZpbmRVbmlxdWUiLCJpZCIsIlN0cmluZyIsImxvZ0Jvb2tEZWxldGlvbiIsImxvZ0Jvb2tSZXN0b3JhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/audit.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/books.ts":
/*!***********************************!*\
  !*** ./src/lib/services/books.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BookService: () => (/* binding */ BookService)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _audit__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./audit */ \"(rsc)/./src/lib/services/audit.ts\");\n\n\nclass BookService {\n    // Gerar código automático para o livro\n    static async generateBookCode(genre) {\n        const currentYear = new Date().getFullYear().toString().slice(-2); // Últimos 2 dígitos do ano\n        // Buscar o último código usado para este ano\n        const lastBook = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findFirst({\n            where: {\n                code: {\n                    contains: `/${currentYear}-`\n                },\n                deletedAt: null\n            },\n            orderBy: {\n                code: \"desc\"\n            }\n        });\n        let nextNumber = 1;\n        if (lastBook) {\n            const lastNumber = parseInt(lastBook.code.split(\"/\")[0]);\n            nextNumber = lastNumber + 1;\n        }\n        // Abreviação do gênero (primeiras 3 letras)\n        const genreAbbreviation = genre.substring(0, 3).toUpperCase();\n        return `${nextNumber.toString().padStart(4, \"0\")}/${currentYear}-${genreAbbreviation}`;\n    }\n    // Buscar livro por ID (apenas ativos)\n    static async getBookById(id) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findFirst({\n            where: {\n                id,\n                deletedAt: null\n            }\n        });\n    }\n    // Buscar livros por filtros (apenas ativos)\n    static async getBooksByFilters(filters) {\n        const { search, status, genre } = filters;\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findMany({\n            where: {\n                AND: [\n                    {\n                        deletedAt: null\n                    },\n                    search ? {\n                        OR: [\n                            {\n                                title: {\n                                    contains: search\n                                }\n                            },\n                            {\n                                author: {\n                                    contains: search\n                                }\n                            },\n                            {\n                                code: {\n                                    contains: search\n                                }\n                            },\n                            {\n                                isbn: {\n                                    contains: search\n                                }\n                            }\n                        ]\n                    } : {},\n                    genre ? {\n                        genre\n                    } : {},\n                    status === \"dispon\\xedvel\" ? {\n                        currentQuantity: {\n                            gt: 0\n                        }\n                    } : {},\n                    status === \"emprestado\" ? {\n                        currentQuantity: {\n                            equals: 0\n                        }\n                    } : {}\n                ]\n            },\n            orderBy: {\n                title: \"asc\"\n            }\n        });\n    }\n    // Criar novo livro\n    static async createBook(data, userId) {\n        try {\n            const code = await this.generateBookCode(data.genre);\n            const book = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.create({\n                data: {\n                    ...data,\n                    code,\n                    quantity: data.quantity || 1,\n                    currentQuantity: data.quantity || 1,\n                    loansCount: 0\n                }\n            });\n            // Log de auditoria\n            await _audit__WEBPACK_IMPORTED_MODULE_1__.AuditService.logBookCreation(book.id, book, userId);\n            return book;\n        } catch (error) {\n            // Verificar se é erro de constraint única\n            if (error.code === \"P2002\") {\n                if (error.meta?.target?.includes(\"isbn\")) {\n                    throw new Error(\"ISBN j\\xe1 existe no sistema. Por favor, use um ISBN diferente.\");\n                }\n                if (error.meta?.target?.includes(\"code\")) {\n                    throw new Error(\"C\\xf3digo do livro j\\xe1 existe. Tente novamente.\");\n                }\n                throw new Error(\"Dados duplicados. Verifique se o livro j\\xe1 existe.\");\n            }\n            throw error;\n        }\n    }\n    // Atualizar livro\n    static async updateBook(id, data, userId) {\n        try {\n            // Buscar dados atuais do livro para comparação\n            const currentBook = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findUnique({\n                where: {\n                    id,\n                    deletedAt: null\n                }\n            });\n            if (!currentBook) {\n                throw new Error(\"Livro n\\xe3o encontrado\");\n            }\n            // Realizar a atualização\n            const updatedBook = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.update({\n                where: {\n                    id,\n                    deletedAt: null\n                },\n                data\n            });\n            // Log de auditoria para campos alterados (com try/catch para não falhar a atualização)\n            try {\n                const changedFields = [];\n                for (const [field, newValue] of Object.entries(data)){\n                    // Ignorar campos que não devem gerar logs\n                    if (field === \"updatedAt\" || field === \"createdAt\" || field === \"deletedAt\") {\n                        continue;\n                    }\n                    const oldValue = currentBook[field];\n                    // Comparar valores convertendo para string para evitar logs desnecessários\n                    if (String(oldValue) !== String(newValue)) {\n                        changedFields.push(field);\n                        await _audit__WEBPACK_IMPORTED_MODULE_1__.AuditService.logBookUpdate(id, field, oldValue, newValue, userId);\n                    }\n                }\n                // Se nenhum campo foi alterado, não criar log\n                if (changedFields.length === 0) {\n                    console.log(\"Nenhum campo foi alterado no livro:\", id);\n                }\n            } catch (auditError) {\n                console.error(\"Erro ao criar log de auditoria:\", auditError);\n            // Não falhar a atualização por causa do log\n            }\n            return updatedBook;\n        } catch (error) {\n            console.error(\"Erro no updateBook:\", error);\n            throw error;\n        }\n    }\n    // Soft delete - marcar como deletado\n    static async softDeleteBook(id, userId) {\n        try {\n            // Buscar dados do livro antes da deleção para o log\n            const bookData = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findUnique({\n                where: {\n                    id\n                }\n            });\n            if (!bookData) {\n                throw new Error(\"Livro n\\xe3o encontrado\");\n            }\n            // Realizar o soft delete\n            const deletedBook = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.update({\n                where: {\n                    id,\n                    deletedAt: null\n                },\n                data: {\n                    deletedAt: new Date()\n                }\n            });\n            // Log de auditoria (com try/catch para não falhar a deleção)\n            try {\n                await _audit__WEBPACK_IMPORTED_MODULE_1__.AuditService.logBookDeletion(id, bookData, userId);\n            } catch (auditError) {\n                console.error(\"Erro ao criar log de auditoria:\", auditError);\n            // Não falhar a deleção por causa do log\n            }\n            return deletedBook;\n        } catch (error) {\n            console.error(\"Erro no softDeleteBook:\", error);\n            throw error;\n        }\n    }\n    // Buscar estatísticas de livros (apenas ativos)\n    static async getBookStats() {\n        const totalBooks = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.count({\n            where: {\n                deletedAt: null\n            }\n        });\n        console.log(totalBooks);\n        // Calcular livros disponíveis (soma de todos os exemplares disponíveis)\n        const booksWithAvailability = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findMany({\n            where: {\n                deletedAt: null\n            },\n            select: {\n                currentQuantity: true\n            }\n        });\n        const availableBooks = booksWithAvailability.reduce((sum, book)=>sum + book.currentQuantity, 0);\n        // Calcular livros emprestados (empréstimos ativos)\n        const activeLoans = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.count({\n            where: {\n                status: \"ACTIVE\"\n            }\n        });\n        const genres = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.groupBy({\n            by: [\n                \"genre\"\n            ],\n            where: {\n                deletedAt: null\n            },\n            _count: {\n                genre: true\n            }\n        });\n        const booksByYear = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.groupBy({\n            by: [\n                \"year\"\n            ],\n            where: {\n                year: {\n                    not: null\n                },\n                deletedAt: null\n            },\n            _count: {\n                year: true\n            }\n        });\n        return {\n            totalBooks,\n            availableBooks,\n            borrowedBooks: activeLoans,\n            genres: genres.map((genre)=>({\n                    genre: genre.genre,\n                    count: genre._count.genre\n                })),\n            booksByYear: booksByYear.map((year)=>({\n                    year: year.year,\n                    count: year._count.year\n                }))\n        };\n    }\n    // Incrementar contador de empréstimos\n    static async incrementLoansCount(bookId) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.update({\n            where: {\n                id: bookId,\n                deletedAt: null\n            },\n            data: {\n                loansCount: {\n                    increment: 1\n                },\n                currentQuantity: {\n                    decrement: 1\n                }\n            }\n        });\n    }\n    // Decrementar contador de empréstimos (quando livro é devolvido)\n    static async decrementLoansCount(bookId) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.update({\n            where: {\n                id: bookId,\n                deletedAt: null\n            },\n            data: {\n                currentQuantity: {\n                    increment: 1\n                }\n            }\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBRUMsS0FBSztnQkFBSztnQkFDbEIzRSxXQUFXO1lBQ2I7WUFDQXdFLFFBQVE7Z0JBQUVFLE1BQU07WUFBSztRQUN2QjtRQUVBLE9BQU87WUFDTGQ7WUFDQUk7WUFDQVksZUFBZVQ7WUFDZkUsUUFBUUEsT0FBT1EsR0FBRyxDQUFDLENBQUN6RixRQUFXO29CQUM3QkEsT0FBT0EsTUFBTUEsS0FBSztvQkFDbEJ5RSxPQUFPekUsTUFBTW9GLE1BQU0sQ0FBQ3BGLEtBQUs7Z0JBQzNCO1lBQ0FxRixhQUFhQSxZQUFZSSxHQUFHLENBQUMsQ0FBQ0gsT0FBVTtvQkFDdENBLE1BQU1BLEtBQUtBLElBQUk7b0JBQ2ZiLE9BQU9hLEtBQUtGLE1BQU0sQ0FBQ0UsSUFBSTtnQkFDekI7UUFDRjtJQUNGO0lBRUEsc0NBQXNDO0lBQ3RDLGFBQWFJLG9CQUFvQkMsTUFBYyxFQUFFO1FBQy9DLE9BQU8sTUFBTS9GLDJDQUFNQSxDQUFDVyxJQUFJLENBQUM4QyxNQUFNLENBQUM7WUFDOUI1QyxPQUFPO2dCQUNMYyxJQUFJb0U7Z0JBQ0ovRSxXQUFXO1lBQ2I7WUFDQTBCLE1BQU07Z0JBQ0pJLFlBQVk7b0JBQ1ZrRCxXQUFXO2dCQUNiO2dCQUNBMUQsaUJBQWlCO29CQUNmMkQsV0FBVztnQkFDYjtZQUNGO1FBQ0Y7SUFDRjtJQUVBLGlFQUFpRTtJQUNqRSxhQUFhQyxvQkFBb0JILE1BQWMsRUFBRTtRQUMvQyxPQUFPLE1BQU0vRiwyQ0FBTUEsQ0FBQ1csSUFBSSxDQUFDOEMsTUFBTSxDQUFDO1lBQzlCNUMsT0FBTztnQkFDTGMsSUFBSW9FO2dCQUNKL0UsV0FBVztZQUNiO1lBQ0EwQixNQUFNO2dCQUNKSixpQkFBaUI7b0JBQ2YwRCxXQUFXO2dCQUNiO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iaWJsaW90ZWNhLWVzY29sYXIvLi9zcmMvbGliL3NlcnZpY2VzL2Jvb2tzLnRzPzNlNmUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIi4uL3ByaXNtYVwiO1xyXG5pbXBvcnQgeyBCb29rIH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XHJcbmltcG9ydCB7IEF1ZGl0U2VydmljZSB9IGZyb20gXCIuL2F1ZGl0XCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUJvb2tEYXRhIHtcclxuICB0aXRsZTogc3RyaW5nO1xyXG4gIGF1dGhvcjogc3RyaW5nO1xyXG4gIHB1Ymxpc2hlcjogc3RyaW5nO1xyXG4gIGdlbnJlOiBzdHJpbmc7XHJcbiAgZW50cnlEYXRlOiBEYXRlO1xyXG4gIHF1YW50aXR5OiBudW1iZXI7XHJcbiAgaXNibj86IHN0cmluZztcclxuICB5ZWFyPzogbnVtYmVyO1xyXG4gIGxvY2F0aW9uPzogc3RyaW5nO1xyXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUJvb2tEYXRhIGV4dGVuZHMgUGFydGlhbDxDcmVhdGVCb29rRGF0YT4ge31cclxuXHJcbmV4cG9ydCBjbGFzcyBCb29rU2VydmljZSB7XHJcbiAgLy8gR2VyYXIgY8OzZGlnbyBhdXRvbcOhdGljbyBwYXJhIG8gbGl2cm9cclxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBnZW5lcmF0ZUJvb2tDb2RlKGdlbnJlOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgY29uc3QgY3VycmVudFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgtMik7IC8vIMOabHRpbW9zIDIgZMOtZ2l0b3MgZG8gYW5vXHJcblxyXG4gICAgLy8gQnVzY2FyIG8gw7psdGltbyBjw7NkaWdvIHVzYWRvIHBhcmEgZXN0ZSBhbm9cclxuICAgIGNvbnN0IGxhc3RCb29rID0gYXdhaXQgcHJpc21hLmJvb2suZmluZEZpcnN0KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBjb2RlOiB7XHJcbiAgICAgICAgICBjb250YWluczogYC8ke2N1cnJlbnRZZWFyfS1gLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxyXG4gICAgICB9LFxyXG4gICAgICBvcmRlckJ5OiB7XHJcbiAgICAgICAgY29kZTogXCJkZXNjXCIsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgbmV4dE51bWJlciA9IDE7XHJcbiAgICBpZiAobGFzdEJvb2spIHtcclxuICAgICAgY29uc3QgbGFzdE51bWJlciA9IHBhcnNlSW50KGxhc3RCb29rLmNvZGUuc3BsaXQoXCIvXCIpWzBdKTtcclxuICAgICAgbmV4dE51bWJlciA9IGxhc3ROdW1iZXIgKyAxO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFicmV2aWHDp8OjbyBkbyBnw6puZXJvIChwcmltZWlyYXMgMyBsZXRyYXMpXHJcbiAgICBjb25zdCBnZW5yZUFiYnJldmlhdGlvbiA9IGdlbnJlLnN1YnN0cmluZygwLCAzKS50b1VwcGVyQ2FzZSgpO1xyXG5cclxuICAgIHJldHVybiBgJHtuZXh0TnVtYmVyXHJcbiAgICAgIC50b1N0cmluZygpXHJcbiAgICAgIC5wYWRTdGFydCg0LCBcIjBcIil9LyR7Y3VycmVudFllYXJ9LSR7Z2VucmVBYmJyZXZpYXRpb259YDtcclxuICB9XHJcblxyXG4gIC8vIEJ1c2NhciBsaXZybyBwb3IgSUQgKGFwZW5hcyBhdGl2b3MpXHJcbiAgc3RhdGljIGFzeW5jIGdldEJvb2tCeUlkKGlkOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBhd2FpdCBwcmlzbWEuYm9vay5maW5kRmlyc3Qoe1xyXG4gICAgICB3aGVyZToge1xyXG4gICAgICAgIGlkLFxyXG4gICAgICAgIGRlbGV0ZWRBdDogbnVsbCxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gQnVzY2FyIGxpdnJvcyBwb3IgZmlsdHJvcyAoYXBlbmFzIGF0aXZvcylcclxuICBzdGF0aWMgYXN5bmMgZ2V0Qm9va3NCeUZpbHRlcnMoZmlsdGVyczoge1xyXG4gICAgc2VhcmNoPzogc3RyaW5nO1xyXG4gICAgc3RhdHVzPzogc3RyaW5nO1xyXG4gICAgZ2VucmU/OiBzdHJpbmc7XHJcbiAgfSkge1xyXG4gICAgY29uc3QgeyBzZWFyY2gsIHN0YXR1cywgZ2VucmUgfSA9IGZpbHRlcnM7XHJcblxyXG4gICAgcmV0dXJuIGF3YWl0IHByaXNtYS5ib29rLmZpbmRNYW55KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBBTkQ6IFtcclxuICAgICAgICAgIHsgZGVsZXRlZEF0OiBudWxsIH0sXHJcbiAgICAgICAgICBzZWFyY2hcclxuICAgICAgICAgICAgPyB7XHJcbiAgICAgICAgICAgICAgICBPUjogW1xyXG4gICAgICAgICAgICAgICAgICB7IHRpdGxlOiB7IGNvbnRhaW5zOiBzZWFyY2ggfSB9LFxyXG4gICAgICAgICAgICAgICAgICB7IGF1dGhvcjogeyBjb250YWluczogc2VhcmNoIH0gfSxcclxuICAgICAgICAgICAgICAgICAgeyBjb2RlOiB7IGNvbnRhaW5zOiBzZWFyY2ggfSB9LFxyXG4gICAgICAgICAgICAgICAgICB7IGlzYm46IHsgY29udGFpbnM6IHNlYXJjaCB9IH0sXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgOiB7fSxcclxuICAgICAgICAgIGdlbnJlID8geyBnZW5yZSB9IDoge30sXHJcbiAgICAgICAgICBzdGF0dXMgPT09IFwiZGlzcG9uw612ZWxcIiA/IHsgY3VycmVudFF1YW50aXR5OiB7IGd0OiAwIH0gfSA6IHt9LFxyXG4gICAgICAgICAgc3RhdHVzID09PSBcImVtcHJlc3RhZG9cIiA/IHsgY3VycmVudFF1YW50aXR5OiB7IGVxdWFsczogMCB9IH0gOiB7fSxcclxuICAgICAgICBdLFxyXG4gICAgICB9LFxyXG4gICAgICBvcmRlckJ5OiB7IHRpdGxlOiBcImFzY1wiIH0sXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIENyaWFyIG5vdm8gbGl2cm9cclxuICBzdGF0aWMgYXN5bmMgY3JlYXRlQm9vayhkYXRhOiBDcmVhdGVCb29rRGF0YSwgdXNlcklkPzogc3RyaW5nKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjb2RlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUJvb2tDb2RlKGRhdGEuZ2VucmUpO1xyXG4gICAgICBjb25zdCBib29rID0gYXdhaXQgcHJpc21hLmJvb2suY3JlYXRlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAuLi5kYXRhLFxyXG4gICAgICAgICAgY29kZSxcclxuICAgICAgICAgIHF1YW50aXR5OiBkYXRhLnF1YW50aXR5IHx8IDEsXHJcbiAgICAgICAgICBjdXJyZW50UXVhbnRpdHk6IGRhdGEucXVhbnRpdHkgfHwgMSxcclxuICAgICAgICAgIGxvYW5zQ291bnQ6IDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICAgIC8vIExvZyBkZSBhdWRpdG9yaWFcclxuICAgICAgYXdhaXQgQXVkaXRTZXJ2aWNlLmxvZ0Jvb2tDcmVhdGlvbihib29rLmlkLCBib29rLCB1c2VySWQpO1xyXG4gICAgICByZXR1cm4gYm9vaztcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgLy8gVmVyaWZpY2FyIHNlIMOpIGVycm8gZGUgY29uc3RyYWludCDDum5pY2FcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiUDIwMDJcIikge1xyXG4gICAgICAgIGlmIChlcnJvci5tZXRhPy50YXJnZXQ/LmluY2x1ZGVzKFwiaXNiblwiKSkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgICBcIklTQk4gasOhIGV4aXN0ZSBubyBzaXN0ZW1hLiBQb3IgZmF2b3IsIHVzZSB1bSBJU0JOIGRpZmVyZW50ZS5cIlxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGVycm9yLm1ldGE/LnRhcmdldD8uaW5jbHVkZXMoXCJjb2RlXCIpKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDw7NkaWdvIGRvIGxpdnJvIGrDoSBleGlzdGUuIFRlbnRlIG5vdmFtZW50ZS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhZG9zIGR1cGxpY2Fkb3MuIFZlcmlmaXF1ZSBzZSBvIGxpdnJvIGrDoSBleGlzdGUuXCIpO1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQXR1YWxpemFyIGxpdnJvXHJcbiAgc3RhdGljIGFzeW5jIHVwZGF0ZUJvb2soaWQ6IHN0cmluZywgZGF0YTogVXBkYXRlQm9va0RhdGEsIHVzZXJJZD86IHN0cmluZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQnVzY2FyIGRhZG9zIGF0dWFpcyBkbyBsaXZybyBwYXJhIGNvbXBhcmHDp8Ojb1xyXG4gICAgICBjb25zdCBjdXJyZW50Qm9vayA9IGF3YWl0IHByaXNtYS5ib29rLmZpbmRVbmlxdWUoe1xyXG4gICAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgICBpZCxcclxuICAgICAgICAgIGRlbGV0ZWRBdDogbnVsbCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghY3VycmVudEJvb2spIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMaXZybyBuw6NvIGVuY29udHJhZG9cIik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJlYWxpemFyIGEgYXR1YWxpemHDp8Ojb1xyXG4gICAgICBjb25zdCB1cGRhdGVkQm9vayA9IGF3YWl0IHByaXNtYS5ib29rLnVwZGF0ZSh7XHJcbiAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBMb2cgZGUgYXVkaXRvcmlhIHBhcmEgY2FtcG9zIGFsdGVyYWRvcyAoY29tIHRyeS9jYXRjaCBwYXJhIG7Do28gZmFsaGFyIGEgYXR1YWxpemHDp8OjbylcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBjaGFuZ2VkRmllbGRzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IFtmaWVsZCwgbmV3VmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XHJcbiAgICAgICAgICAvLyBJZ25vcmFyIGNhbXBvcyBxdWUgbsOjbyBkZXZlbSBnZXJhciBsb2dzXHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIGZpZWxkID09PSBcInVwZGF0ZWRBdFwiIHx8XHJcbiAgICAgICAgICAgIGZpZWxkID09PSBcImNyZWF0ZWRBdFwiIHx8XHJcbiAgICAgICAgICAgIGZpZWxkID09PSBcImRlbGV0ZWRBdFwiXHJcbiAgICAgICAgICApIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBjdXJyZW50Qm9va1tmaWVsZCBhcyBrZXlvZiB0eXBlb2YgY3VycmVudEJvb2tdO1xyXG5cclxuICAgICAgICAgIC8vIENvbXBhcmFyIHZhbG9yZXMgY29udmVydGVuZG8gcGFyYSBzdHJpbmcgcGFyYSBldml0YXIgbG9ncyBkZXNuZWNlc3PDoXJpb3NcclxuICAgICAgICAgIGlmIChTdHJpbmcob2xkVmFsdWUpICE9PSBTdHJpbmcobmV3VmFsdWUpKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZWRGaWVsZHMucHVzaChmaWVsZCk7XHJcbiAgICAgICAgICAgIGF3YWl0IEF1ZGl0U2VydmljZS5sb2dCb29rVXBkYXRlKFxyXG4gICAgICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgICAgIGZpZWxkLFxyXG4gICAgICAgICAgICAgIG9sZFZhbHVlLFxyXG4gICAgICAgICAgICAgIG5ld1ZhbHVlLFxyXG4gICAgICAgICAgICAgIHVzZXJJZFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2UgbmVuaHVtIGNhbXBvIGZvaSBhbHRlcmFkbywgbsOjbyBjcmlhciBsb2dcclxuICAgICAgICBpZiAoY2hhbmdlZEZpZWxkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiTmVuaHVtIGNhbXBvIGZvaSBhbHRlcmFkbyBubyBsaXZybzpcIiwgaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoYXVkaXRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvIGFvIGNyaWFyIGxvZyBkZSBhdWRpdG9yaWE6XCIsIGF1ZGl0RXJyb3IpO1xyXG4gICAgICAgIC8vIE7Do28gZmFsaGFyIGEgYXR1YWxpemHDp8OjbyBwb3IgY2F1c2EgZG8gbG9nXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB1cGRhdGVkQm9vaztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvIG5vIHVwZGF0ZUJvb2s6XCIsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBTb2Z0IGRlbGV0ZSAtIG1hcmNhciBjb21vIGRlbGV0YWRvXHJcbiAgc3RhdGljIGFzeW5jIHNvZnREZWxldGVCb29rKGlkOiBzdHJpbmcsIHVzZXJJZD86IHN0cmluZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQnVzY2FyIGRhZG9zIGRvIGxpdnJvIGFudGVzIGRhIGRlbGXDp8OjbyBwYXJhIG8gbG9nXHJcbiAgICAgIGNvbnN0IGJvb2tEYXRhID0gYXdhaXQgcHJpc21hLmJvb2suZmluZFVuaXF1ZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIWJvb2tEYXRhKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTGl2cm8gbsOjbyBlbmNvbnRyYWRvXCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBSZWFsaXphciBvIHNvZnQgZGVsZXRlXHJcbiAgICAgIGNvbnN0IGRlbGV0ZWRCb29rID0gYXdhaXQgcHJpc21hLmJvb2sudXBkYXRlKHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgaWQsXHJcbiAgICAgICAgICBkZWxldGVkQXQ6IG51bGwsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBkZWxldGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBMb2cgZGUgYXVkaXRvcmlhIChjb20gdHJ5L2NhdGNoIHBhcmEgbsOjbyBmYWxoYXIgYSBkZWxlw6fDo28pXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgQXVkaXRTZXJ2aWNlLmxvZ0Jvb2tEZWxldGlvbihpZCwgYm9va0RhdGEsIHVzZXJJZCk7XHJcbiAgICAgIH0gY2F0Y2ggKGF1ZGl0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJybyBhbyBjcmlhciBsb2cgZGUgYXVkaXRvcmlhOlwiLCBhdWRpdEVycm9yKTtcclxuICAgICAgICAvLyBOw6NvIGZhbGhhciBhIGRlbGXDp8OjbyBwb3IgY2F1c2EgZG8gbG9nXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBkZWxldGVkQm9vaztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvIG5vIHNvZnREZWxldGVCb29rOlwiLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQnVzY2FyIGVzdGF0w61zdGljYXMgZGUgbGl2cm9zIChhcGVuYXMgYXRpdm9zKVxyXG4gIHN0YXRpYyBhc3luYyBnZXRCb29rU3RhdHMoKSB7XHJcbiAgICBjb25zdCB0b3RhbEJvb2tzID0gYXdhaXQgcHJpc21hLmJvb2suY291bnQoe1xyXG4gICAgICB3aGVyZTogeyBkZWxldGVkQXQ6IG51bGwgfSxcclxuICAgIH0pO1xyXG4gICAgY29uc29sZS5sb2codG90YWxCb29rcyk7XHJcbiAgICAvLyBDYWxjdWxhciBsaXZyb3MgZGlzcG9uw612ZWlzIChzb21hIGRlIHRvZG9zIG9zIGV4ZW1wbGFyZXMgZGlzcG9uw612ZWlzKVxyXG4gICAgY29uc3QgYm9va3NXaXRoQXZhaWxhYmlsaXR5ID0gYXdhaXQgcHJpc21hLmJvb2suZmluZE1hbnkoe1xyXG4gICAgICB3aGVyZTogeyBkZWxldGVkQXQ6IG51bGwgfSxcclxuICAgICAgc2VsZWN0OiB7IGN1cnJlbnRRdWFudGl0eTogdHJ1ZSB9LFxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBhdmFpbGFibGVCb29rcyA9IGJvb2tzV2l0aEF2YWlsYWJpbGl0eS5yZWR1Y2UoXHJcbiAgICAgIChzdW0sIGJvb2spID0+IHN1bSArIGJvb2suY3VycmVudFF1YW50aXR5LFxyXG4gICAgICAwXHJcbiAgICApO1xyXG5cclxuICAgIC8vIENhbGN1bGFyIGxpdnJvcyBlbXByZXN0YWRvcyAoZW1wcsOpc3RpbW9zIGF0aXZvcylcclxuICAgIGNvbnN0IGFjdGl2ZUxvYW5zID0gYXdhaXQgcHJpc21hLmxvYW4uY291bnQoe1xyXG4gICAgICB3aGVyZTogeyBzdGF0dXM6IFwiQUNUSVZFXCIgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGdlbnJlcyA9IGF3YWl0IHByaXNtYS5ib29rLmdyb3VwQnkoe1xyXG4gICAgICBieTogW1wiZ2VucmVcIl0sXHJcbiAgICAgIHdoZXJlOiB7IGRlbGV0ZWRBdDogbnVsbCB9LFxyXG4gICAgICBfY291bnQ6IHsgZ2VucmU6IHRydWUgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGJvb2tzQnlZZWFyID0gYXdhaXQgcHJpc21hLmJvb2suZ3JvdXBCeSh7XHJcbiAgICAgIGJ5OiBbXCJ5ZWFyXCJdLFxyXG4gICAgICB3aGVyZToge1xyXG4gICAgICAgIHllYXI6IHsgbm90OiBudWxsIH0sXHJcbiAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxyXG4gICAgICB9LFxyXG4gICAgICBfY291bnQ6IHsgeWVhcjogdHJ1ZSB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG90YWxCb29rcyxcclxuICAgICAgYXZhaWxhYmxlQm9va3MsXHJcbiAgICAgIGJvcnJvd2VkQm9va3M6IGFjdGl2ZUxvYW5zLFxyXG4gICAgICBnZW5yZXM6IGdlbnJlcy5tYXAoKGdlbnJlKSA9PiAoe1xyXG4gICAgICAgIGdlbnJlOiBnZW5yZS5nZW5yZSxcclxuICAgICAgICBjb3VudDogZ2VucmUuX2NvdW50LmdlbnJlLFxyXG4gICAgICB9KSksXHJcbiAgICAgIGJvb2tzQnlZZWFyOiBib29rc0J5WWVhci5tYXAoKHllYXIpID0+ICh7XHJcbiAgICAgICAgeWVhcjogeWVhci55ZWFyLFxyXG4gICAgICAgIGNvdW50OiB5ZWFyLl9jb3VudC55ZWFyLFxyXG4gICAgICB9KSksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gSW5jcmVtZW50YXIgY29udGFkb3IgZGUgZW1wcsOpc3RpbW9zXHJcbiAgc3RhdGljIGFzeW5jIGluY3JlbWVudExvYW5zQ291bnQoYm9va0lkOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBhd2FpdCBwcmlzbWEuYm9vay51cGRhdGUoe1xyXG4gICAgICB3aGVyZToge1xyXG4gICAgICAgIGlkOiBib29rSWQsXHJcbiAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxyXG4gICAgICB9LFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgbG9hbnNDb3VudDoge1xyXG4gICAgICAgICAgaW5jcmVtZW50OiAxLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY3VycmVudFF1YW50aXR5OiB7XHJcbiAgICAgICAgICBkZWNyZW1lbnQ6IDEsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVjcmVtZW50YXIgY29udGFkb3IgZGUgZW1wcsOpc3RpbW9zIChxdWFuZG8gbGl2cm8gw6kgZGV2b2x2aWRvKVxyXG4gIHN0YXRpYyBhc3luYyBkZWNyZW1lbnRMb2Fuc0NvdW50KGJvb2tJZDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgcHJpc21hLmJvb2sudXBkYXRlKHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBpZDogYm9va0lkLFxyXG4gICAgICAgIGRlbGV0ZWRBdDogbnVsbCxcclxuICAgICAgfSxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIGN1cnJlbnRRdWFudGl0eToge1xyXG4gICAgICAgICAgaW5jcmVtZW50OiAxLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbInByaXNtYSIsIkF1ZGl0U2VydmljZSIsIkJvb2tTZXJ2aWNlIiwiZ2VuZXJhdGVCb29rQ29kZSIsImdlbnJlIiwiY3VycmVudFllYXIiLCJEYXRlIiwiZ2V0RnVsbFllYXIiLCJ0b1N0cmluZyIsInNsaWNlIiwibGFzdEJvb2siLCJib29rIiwiZmluZEZpcnN0Iiwid2hlcmUiLCJjb2RlIiwiY29udGFpbnMiLCJkZWxldGVkQXQiLCJvcmRlckJ5IiwibmV4dE51bWJlciIsImxhc3ROdW1iZXIiLCJwYXJzZUludCIsInNwbGl0IiwiZ2VucmVBYmJyZXZpYXRpb24iLCJzdWJzdHJpbmciLCJ0b1VwcGVyQ2FzZSIsInBhZFN0YXJ0IiwiZ2V0Qm9va0J5SWQiLCJpZCIsImdldEJvb2tzQnlGaWx0ZXJzIiwiZmlsdGVycyIsInNlYXJjaCIsInN0YXR1cyIsImZpbmRNYW55IiwiQU5EIiwiT1IiLCJ0aXRsZSIsImF1dGhvciIsImlzYm4iLCJjdXJyZW50UXVhbnRpdHkiLCJndCIsImVxdWFscyIsImNyZWF0ZUJvb2siLCJkYXRhIiwidXNlcklkIiwiY3JlYXRlIiwicXVhbnRpdHkiLCJsb2Fuc0NvdW50IiwibG9nQm9va0NyZWF0aW9uIiwiZXJyb3IiLCJtZXRhIiwidGFyZ2V0IiwiaW5jbHVkZXMiLCJFcnJvciIsInVwZGF0ZUJvb2siLCJjdXJyZW50Qm9vayIsImZpbmRVbmlxdWUiLCJ1cGRhdGVkQm9vayIsInVwZGF0ZSIsImNoYW5nZWRGaWVsZHMiLCJmaWVsZCIsIm5ld1ZhbHVlIiwiT2JqZWN0IiwiZW50cmllcyIsIm9sZFZhbHVlIiwiU3RyaW5nIiwicHVzaCIsImxvZ0Jvb2tVcGRhdGUiLCJsZW5ndGgiLCJjb25zb2xlIiwibG9nIiwiYXVkaXRFcnJvciIsInNvZnREZWxldGVCb29rIiwiYm9va0RhdGEiLCJkZWxldGVkQm9vayIsImxvZ0Jvb2tEZWxldGlvbiIsImdldEJvb2tTdGF0cyIsInRvdGFsQm9va3MiLCJjb3VudCIsImJvb2tzV2l0aEF2YWlsYWJpbGl0eSIsInNlbGVjdCIsImF2YWlsYWJsZUJvb2tzIiwicmVkdWNlIiwic3VtIiwiYWN0aXZlTG9hbnMiLCJsb2FuIiwiZ2VucmVzIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiYm9va3NCeVllYXIiLCJ5ZWFyIiwibm90IiwiYm9ycm93ZWRCb29rcyIsIm1hcCIsImluY3JlbWVudExvYW5zQ291bnQiLCJib29rSWQiLCJpbmNyZW1lbnQiLCJkZWNyZW1lbnQiLCJkZWNyZW1lbnRMb2Fuc0NvdW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/books.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/services/loans.ts":
/*!***********************************!*\
  !*** ./src/lib/services/loans.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LoanService: () => (/* binding */ LoanService)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _books__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./books */ \"(rsc)/./src/lib/services/books.ts\");\n\n\nclass LoanService {\n    // Buscar todos os empréstimos\n    static async getAllLoans() {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findMany({\n            include: {\n                book: true,\n                student: true\n            },\n            orderBy: {\n                borrowedAt: \"desc\"\n            }\n        });\n    }\n    // Buscar empréstimo por ID\n    static async getLoanById(id) {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findUnique({\n            where: {\n                id\n            },\n            include: {\n                book: true,\n                student: true\n            }\n        });\n    }\n    // Buscar empréstimos por filtros\n    static async getLoansByFilters(filters) {\n        const { search, status, period } = filters;\n        let dateFilter = {};\n        if (period === \"mes\") {\n            const oneMonthAgo = new Date();\n            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);\n            dateFilter = {\n                borrowedAt: {\n                    gte: oneMonthAgo\n                }\n            };\n        } else if (period === \"trimestre\") {\n            const threeMonthsAgo = new Date();\n            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);\n            dateFilter = {\n                borrowedAt: {\n                    gte: threeMonthsAgo\n                }\n            };\n        } else if (period === \"ano\") {\n            const oneYearAgo = new Date();\n            oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);\n            dateFilter = {\n                borrowedAt: {\n                    gte: oneYearAgo\n                }\n            };\n        }\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findMany({\n            where: {\n                AND: [\n                    search ? {\n                        OR: [\n                            {\n                                book: {\n                                    title: {\n                                        contains: search\n                                    }\n                                }\n                            },\n                            {\n                                book: {\n                                    code: {\n                                        contains: search\n                                    }\n                                }\n                            },\n                            {\n                                student: {\n                                    name: {\n                                        contains: search\n                                    }\n                                }\n                            }\n                        ]\n                    } : {},\n                    status ? {\n                        status\n                    } : {},\n                    dateFilter\n                ]\n            },\n            include: {\n                book: true,\n                student: true\n            },\n            orderBy: {\n                borrowedAt: \"desc\"\n            }\n        });\n    }\n    // Criar novo empréstimo\n    static async createLoan(data) {\n        // Verificar se o livro existe e tem exemplares disponíveis\n        const book = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findUnique({\n            where: {\n                id: data.bookId\n            }\n        });\n        if (!book) {\n            throw new Error(\"Livro n\\xe3o encontrado\");\n        }\n        if (book.currentQuantity <= 0) {\n            throw new Error(\"N\\xe3o h\\xe1 exemplares dispon\\xedveis deste livro\");\n        }\n        // Verificar se o aluno já tem um empréstimo ativo deste livro\n        const existingLoan = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findFirst({\n            where: {\n                bookId: data.bookId,\n                studentId: data.studentId,\n                status: \"ACTIVE\"\n            }\n        });\n        if (existingLoan) {\n            throw new Error(\"O aluno j\\xe1 possui um empr\\xe9stimo ativo deste livro\");\n        }\n        // Criar o empréstimo\n        const loan = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.create({\n            data,\n            include: {\n                book: true,\n                student: true\n            }\n        });\n        // Atualizar quantidade disponível e contador de empréstimos do livro\n        await _books__WEBPACK_IMPORTED_MODULE_1__.BookService.incrementLoansCount(data.bookId);\n        return loan;\n    }\n    // Devolver empréstimo\n    static async returnLoan(id) {\n        const loan = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.update({\n            where: {\n                id\n            },\n            data: {\n                status: \"RETURNED\",\n                returnedAt: new Date()\n            },\n            include: {\n                book: true,\n                student: true\n            }\n        });\n        // Atualizar quantidade disponível do livro\n        await _books__WEBPACK_IMPORTED_MODULE_1__.BookService.decrementLoansCount(loan.bookId);\n        return loan;\n    }\n    // Deletar empréstimo\n    static async deleteLoan(id) {\n        const loan = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findUnique({\n            where: {\n                id\n            },\n            select: {\n                bookId: true,\n                status: true\n            }\n        });\n        if (loan && loan.status === \"ACTIVE\") {\n            // Se o empréstimo está ativo, devolver o livro ao acervo\n            await _books__WEBPACK_IMPORTED_MODULE_1__.BookService.decrementLoansCount(loan.bookId);\n        }\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.delete({\n            where: {\n                id\n            }\n        });\n    }\n    // Buscar estatísticas de empréstimos\n    static async getLoanStats() {\n        const totalLoans = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.count();\n        const activeLoans = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.count({\n            where: {\n                status: \"ACTIVE\"\n            }\n        });\n        const returnedLoans = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.count({\n            where: {\n                status: \"RETURNED\"\n            }\n        });\n        const overdueLoans = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.count({\n            where: {\n                status: \"ACTIVE\",\n                dueDate: {\n                    lt: new Date()\n                }\n            }\n        });\n        return {\n            totalLoans,\n            activeLoans,\n            returnedLoans,\n            overdueLoans\n        };\n    }\n    // Buscar empréstimos em atraso\n    static async getOverdueLoans() {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findMany({\n            where: {\n                status: \"ACTIVE\",\n                dueDate: {\n                    lt: new Date()\n                }\n            },\n            include: {\n                book: true,\n                student: true\n            },\n            orderBy: {\n                dueDate: \"asc\"\n            }\n        });\n    }\n    // Buscar empréstimos por período\n    static async getLoansByPeriod(period) {\n        let startDate = new Date();\n        switch(period){\n            case \"mes\":\n                startDate.setMonth(startDate.getMonth() - 1);\n                break;\n            case \"trimestre\":\n                startDate.setMonth(startDate.getMonth() - 3);\n                break;\n            case \"ano\":\n                startDate.setFullYear(startDate.getFullYear() - 1);\n                break;\n            default:\n                startDate = new Date(0) // Desde o início\n                ;\n        }\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findMany({\n            where: {\n                borrowedAt: {\n                    gte: startDate\n                }\n            },\n            include: {\n                book: true,\n                student: true\n            },\n            orderBy: {\n                borrowedAt: \"desc\"\n            }\n        });\n    }\n    // Buscar livros disponíveis para empréstimo\n    static async getAvailableBooks() {\n        return await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.book.findMany({\n            where: {\n                currentQuantity: {\n                    gt: 0\n                },\n                deletedAt: null\n            },\n            orderBy: {\n                title: \"asc\"\n            }\n        });\n    }\n    // Verificar se aluno pode emprestar um livro específico\n    static async canStudentBorrowBook(studentId, bookId) {\n        const existingLoan = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.loan.findFirst({\n            where: {\n                bookId,\n                studentId,\n                status: \"ACTIVE\"\n            }\n        });\n        return !existingLoan;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dUMsVUFBVXhDLFFBQVEsQ0FBQ3dDLFVBQVV2QyxRQUFRLEtBQUs7Z0JBQzFDO1lBQ0YsS0FBSztnQkFDSHVDLFVBQVVuQyxXQUFXLENBQUNtQyxVQUFVbEMsV0FBVyxLQUFLO2dCQUNoRDtZQUNGO2dCQUNFa0MsWUFBWSxJQUFJekMsS0FBSyxHQUFHLGlCQUFpQjs7UUFDN0M7UUFFQSxPQUFPLE1BQU10QiwyQ0FBTUEsQ0FBQ0ksSUFBSSxDQUFDQyxRQUFRLENBQUM7WUFDaENTLE9BQU87Z0JBQ0xKLFlBQVk7b0JBQUVlLEtBQUtzQztnQkFBVTtZQUMvQjtZQUNBekQsU0FBUztnQkFDUEMsTUFBTTtnQkFDTkMsU0FBUztZQUNYO1lBQ0FDLFNBQVM7Z0JBQUVDLFlBQVk7WUFBTztRQUNoQztJQUNGO0lBRUEsNENBQTRDO0lBQzVDLGFBQWFzRCxvQkFBb0I7UUFDL0IsT0FBTyxNQUFNaEUsMkNBQU1BLENBQUNPLElBQUksQ0FBQ0YsUUFBUSxDQUFDO1lBQ2hDUyxPQUFPO2dCQUNMMEIsaUJBQWlCO29CQUFFeUIsSUFBSTtnQkFBRTtnQkFDekJDLFdBQVc7WUFDYjtZQUNBekQsU0FBUztnQkFBRXVCLE9BQU87WUFBTTtRQUMxQjtJQUNGO0lBRUEsd0RBQXdEO0lBQ3hELGFBQWFtQyxxQkFBcUJ4QixTQUFpQixFQUFFTCxNQUFjLEVBQUU7UUFDbkUsTUFBTUcsZUFBZSxNQUFNekMsMkNBQU1BLENBQUNJLElBQUksQ0FBQ3NDLFNBQVMsQ0FBQztZQUMvQzVCLE9BQU87Z0JBQ0x3QjtnQkFDQUs7Z0JBQ0F6QixRQUFRO1lBQ1Y7UUFDRjtRQUVBLE9BQU8sQ0FBQ3VCO0lBQ1Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2JpYmxpb3RlY2EtZXNjb2xhci8uL3NyYy9saWIvc2VydmljZXMvbG9hbnMudHM/NjEwNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9wcmlzbWEnXHJcbmltcG9ydCB7IExvYW4sIExvYW5TdGF0dXMgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcclxuaW1wb3J0IHsgQm9va1NlcnZpY2UgfSBmcm9tICcuL2Jvb2tzJ1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVMb2FuRGF0YSB7XHJcbiAgYm9va0lkOiBzdHJpbmdcclxuICBzdHVkZW50SWQ6IHN0cmluZ1xyXG4gIGR1ZURhdGU6IERhdGVcclxuICBub3Rlcz86IHN0cmluZ1xyXG59XHJcblxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBMb2FuU2VydmljZSB7XHJcbiAgLy8gQnVzY2FyIHRvZG9zIG9zIGVtcHLDqXN0aW1vc1xyXG4gIHN0YXRpYyBhc3luYyBnZXRBbGxMb2FucygpIHtcclxuICAgIHJldHVybiBhd2FpdCBwcmlzbWEubG9hbi5maW5kTWFueSh7XHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBib29rOiB0cnVlLFxyXG4gICAgICAgIHN0dWRlbnQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBib3Jyb3dlZEF0OiAnZGVzYycgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIEJ1c2NhciBlbXByw6lzdGltbyBwb3IgSURcclxuICBzdGF0aWMgYXN5bmMgZ2V0TG9hbkJ5SWQoaWQ6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGF3YWl0IHByaXNtYS5sb2FuLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZCB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgYm9vazogdHJ1ZSxcclxuICAgICAgICBzdHVkZW50OiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBCdXNjYXIgZW1wcsOpc3RpbW9zIHBvciBmaWx0cm9zXHJcbiAgc3RhdGljIGFzeW5jIGdldExvYW5zQnlGaWx0ZXJzKGZpbHRlcnM6IHtcclxuICAgIHNlYXJjaD86IHN0cmluZ1xyXG4gICAgc3RhdHVzPzogTG9hblN0YXR1c1xyXG4gICAgcGVyaW9kPzogc3RyaW5nXHJcbiAgfSkge1xyXG4gICAgY29uc3QgeyBzZWFyY2gsIHN0YXR1cywgcGVyaW9kIH0gPSBmaWx0ZXJzXHJcbiAgICBcclxuICAgIGxldCBkYXRlRmlsdGVyID0ge31cclxuICAgIGlmIChwZXJpb2QgPT09ICdtZXMnKSB7XHJcbiAgICAgIGNvbnN0IG9uZU1vbnRoQWdvID0gbmV3IERhdGUoKVxyXG4gICAgICBvbmVNb250aEFnby5zZXRNb250aChvbmVNb250aEFnby5nZXRNb250aCgpIC0gMSlcclxuICAgICAgZGF0ZUZpbHRlciA9IHsgYm9ycm93ZWRBdDogeyBndGU6IG9uZU1vbnRoQWdvIH0gfVxyXG4gICAgfSBlbHNlIGlmIChwZXJpb2QgPT09ICd0cmltZXN0cmUnKSB7XHJcbiAgICAgIGNvbnN0IHRocmVlTW9udGhzQWdvID0gbmV3IERhdGUoKVxyXG4gICAgICB0aHJlZU1vbnRoc0Fnby5zZXRNb250aCh0aHJlZU1vbnRoc0Fnby5nZXRNb250aCgpIC0gMylcclxuICAgICAgZGF0ZUZpbHRlciA9IHsgYm9ycm93ZWRBdDogeyBndGU6IHRocmVlTW9udGhzQWdvIH0gfVxyXG4gICAgfSBlbHNlIGlmIChwZXJpb2QgPT09ICdhbm8nKSB7XHJcbiAgICAgIGNvbnN0IG9uZVllYXJBZ28gPSBuZXcgRGF0ZSgpXHJcbiAgICAgIG9uZVllYXJBZ28uc2V0RnVsbFllYXIob25lWWVhckFnby5nZXRGdWxsWWVhcigpIC0gMSlcclxuICAgICAgZGF0ZUZpbHRlciA9IHsgYm9ycm93ZWRBdDogeyBndGU6IG9uZVllYXJBZ28gfSB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBhd2FpdCBwcmlzbWEubG9hbi5maW5kTWFueSh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgQU5EOiBbXHJcbiAgICAgICAgICBzZWFyY2ggPyB7XHJcbiAgICAgICAgICAgIE9SOiBbXHJcbiAgICAgICAgICAgICAgeyBib29rOiB7IHRpdGxlOiB7IGNvbnRhaW5zOiBzZWFyY2ggfSB9IH0sXHJcbiAgICAgICAgICAgICAgeyBib29rOiB7IGNvZGU6IHsgY29udGFpbnM6IHNlYXJjaCB9IH0gfSxcclxuICAgICAgICAgICAgICB7IHN0dWRlbnQ6IHsgbmFtZTogeyBjb250YWluczogc2VhcmNoIH0gfSB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICAgIH0gOiB7fSxcclxuICAgICAgICAgIHN0YXR1cyA/IHsgc3RhdHVzIH0gOiB7fSxcclxuICAgICAgICAgIGRhdGVGaWx0ZXJcclxuICAgICAgICBdXHJcbiAgICAgIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBib29rOiB0cnVlLFxyXG4gICAgICAgIHN0dWRlbnQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBib3Jyb3dlZEF0OiAnZGVzYycgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIENyaWFyIG5vdm8gZW1wcsOpc3RpbW9cclxuICBzdGF0aWMgYXN5bmMgY3JlYXRlTG9hbihkYXRhOiBDcmVhdGVMb2FuRGF0YSkge1xyXG4gICAgLy8gVmVyaWZpY2FyIHNlIG8gbGl2cm8gZXhpc3RlIGUgdGVtIGV4ZW1wbGFyZXMgZGlzcG9uw612ZWlzXHJcbiAgICBjb25zdCBib29rID0gYXdhaXQgcHJpc21hLmJvb2suZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiBkYXRhLmJvb2tJZCB9XHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghYm9vaykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xpdnJvIG7Do28gZW5jb250cmFkbycpXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGJvb2suY3VycmVudFF1YW50aXR5IDw9IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdOw6NvIGjDoSBleGVtcGxhcmVzIGRpc3BvbsOtdmVpcyBkZXN0ZSBsaXZybycpXHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIHNlIG8gYWx1bm8gasOhIHRlbSB1bSBlbXByw6lzdGltbyBhdGl2byBkZXN0ZSBsaXZyb1xyXG4gICAgY29uc3QgZXhpc3RpbmdMb2FuID0gYXdhaXQgcHJpc21hLmxvYW4uZmluZEZpcnN0KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBib29rSWQ6IGRhdGEuYm9va0lkLFxyXG4gICAgICAgIHN0dWRlbnRJZDogZGF0YS5zdHVkZW50SWQsXHJcbiAgICAgICAgc3RhdHVzOiAnQUNUSVZFJ1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGlmIChleGlzdGluZ0xvYW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPIGFsdW5vIGrDoSBwb3NzdWkgdW0gZW1wcsOpc3RpbW8gYXRpdm8gZGVzdGUgbGl2cm8nKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENyaWFyIG8gZW1wcsOpc3RpbW9cclxuICAgIGNvbnN0IGxvYW4gPSBhd2FpdCBwcmlzbWEubG9hbi5jcmVhdGUoe1xyXG4gICAgICBkYXRhLFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgYm9vazogdHJ1ZSxcclxuICAgICAgICBzdHVkZW50OiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgLy8gQXR1YWxpemFyIHF1YW50aWRhZGUgZGlzcG9uw612ZWwgZSBjb250YWRvciBkZSBlbXByw6lzdGltb3MgZG8gbGl2cm9cclxuICAgIGF3YWl0IEJvb2tTZXJ2aWNlLmluY3JlbWVudExvYW5zQ291bnQoZGF0YS5ib29rSWQpXHJcblxyXG4gICAgcmV0dXJuIGxvYW5cclxuICB9XHJcblxyXG5cclxuXHJcbiAgLy8gRGV2b2x2ZXIgZW1wcsOpc3RpbW9cclxuICBzdGF0aWMgYXN5bmMgcmV0dXJuTG9hbihpZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBsb2FuID0gYXdhaXQgcHJpc21hLmxvYW4udXBkYXRlKHtcclxuICAgICAgd2hlcmU6IHsgaWQgfSxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHN0YXR1czogJ1JFVFVSTkVEJyxcclxuICAgICAgICByZXR1cm5lZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICAgIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBib29rOiB0cnVlLFxyXG4gICAgICAgIHN0dWRlbnQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBBdHVhbGl6YXIgcXVhbnRpZGFkZSBkaXNwb27DrXZlbCBkbyBsaXZyb1xyXG4gICAgYXdhaXQgQm9va1NlcnZpY2UuZGVjcmVtZW50TG9hbnNDb3VudChsb2FuLmJvb2tJZClcclxuXHJcbiAgICByZXR1cm4gbG9hblxyXG4gIH1cclxuXHJcbiAgLy8gRGVsZXRhciBlbXByw6lzdGltb1xyXG4gIHN0YXRpYyBhc3luYyBkZWxldGVMb2FuKGlkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGxvYW4gPSBhd2FpdCBwcmlzbWEubG9hbi5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQgfSxcclxuICAgICAgc2VsZWN0OiB7IGJvb2tJZDogdHJ1ZSwgc3RhdHVzOiB0cnVlIH1cclxuICAgIH0pXHJcblxyXG4gICAgaWYgKGxvYW4gJiYgbG9hbi5zdGF0dXMgPT09ICdBQ1RJVkUnKSB7XHJcbiAgICAgIC8vIFNlIG8gZW1wcsOpc3RpbW8gZXN0w6EgYXRpdm8sIGRldm9sdmVyIG8gbGl2cm8gYW8gYWNlcnZvXHJcbiAgICAgIGF3YWl0IEJvb2tTZXJ2aWNlLmRlY3JlbWVudExvYW5zQ291bnQobG9hbi5ib29rSWQpXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF3YWl0IHByaXNtYS5sb2FuLmRlbGV0ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBCdXNjYXIgZXN0YXTDrXN0aWNhcyBkZSBlbXByw6lzdGltb3NcclxuICBzdGF0aWMgYXN5bmMgZ2V0TG9hblN0YXRzKCkge1xyXG4gICAgY29uc3QgdG90YWxMb2FucyA9IGF3YWl0IHByaXNtYS5sb2FuLmNvdW50KClcclxuICAgIGNvbnN0IGFjdGl2ZUxvYW5zID0gYXdhaXQgcHJpc21hLmxvYW4uY291bnQoe1xyXG4gICAgICB3aGVyZTogeyBzdGF0dXM6ICdBQ1RJVkUnIH1cclxuICAgIH0pXHJcbiAgICBjb25zdCByZXR1cm5lZExvYW5zID0gYXdhaXQgcHJpc21hLmxvYW4uY291bnQoe1xyXG4gICAgICB3aGVyZTogeyBzdGF0dXM6ICdSRVRVUk5FRCcgfVxyXG4gICAgfSlcclxuICAgIGNvbnN0IG92ZXJkdWVMb2FucyA9IGF3YWl0IHByaXNtYS5sb2FuLmNvdW50KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBzdGF0dXM6ICdBQ1RJVkUnLFxyXG4gICAgICAgIGR1ZURhdGU6IHsgbHQ6IG5ldyBEYXRlKCkgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsTG9hbnMsXHJcbiAgICAgIGFjdGl2ZUxvYW5zLFxyXG4gICAgICByZXR1cm5lZExvYW5zLFxyXG4gICAgICBvdmVyZHVlTG9hbnNcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEJ1c2NhciBlbXByw6lzdGltb3MgZW0gYXRyYXNvXHJcbiAgc3RhdGljIGFzeW5jIGdldE92ZXJkdWVMb2FucygpIHtcclxuICAgIHJldHVybiBhd2FpdCBwcmlzbWEubG9hbi5maW5kTWFueSh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgc3RhdHVzOiAnQUNUSVZFJyxcclxuICAgICAgICBkdWVEYXRlOiB7IGx0OiBuZXcgRGF0ZSgpIH1cclxuICAgICAgfSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIGJvb2s6IHRydWUsXHJcbiAgICAgICAgc3R1ZGVudDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICBvcmRlckJ5OiB7IGR1ZURhdGU6ICdhc2MnIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBCdXNjYXIgZW1wcsOpc3RpbW9zIHBvciBwZXLDrW9kb1xyXG4gIHN0YXRpYyBhc3luYyBnZXRMb2Fuc0J5UGVyaW9kKHBlcmlvZDogc3RyaW5nKSB7XHJcbiAgICBsZXQgc3RhcnREYXRlID0gbmV3IERhdGUoKVxyXG4gICAgXHJcbiAgICBzd2l0Y2ggKHBlcmlvZCkge1xyXG4gICAgICBjYXNlICdtZXMnOlxyXG4gICAgICAgIHN0YXJ0RGF0ZS5zZXRNb250aChzdGFydERhdGUuZ2V0TW9udGgoKSAtIDEpXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgY2FzZSAndHJpbWVzdHJlJzpcclxuICAgICAgICBzdGFydERhdGUuc2V0TW9udGgoc3RhcnREYXRlLmdldE1vbnRoKCkgLSAzKVxyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIGNhc2UgJ2Fubyc6XHJcbiAgICAgICAgc3RhcnREYXRlLnNldEZ1bGxZZWFyKHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpIC0gMSlcclxuICAgICAgICBicmVha1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKDApIC8vIERlc2RlIG8gaW7DrWNpb1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhd2FpdCBwcmlzbWEubG9hbi5maW5kTWFueSh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgYm9ycm93ZWRBdDogeyBndGU6IHN0YXJ0RGF0ZSB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBib29rOiB0cnVlLFxyXG4gICAgICAgIHN0dWRlbnQ6IHRydWVcclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBib3Jyb3dlZEF0OiAnZGVzYycgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIEJ1c2NhciBsaXZyb3MgZGlzcG9uw612ZWlzIHBhcmEgZW1wcsOpc3RpbW9cclxuICBzdGF0aWMgYXN5bmMgZ2V0QXZhaWxhYmxlQm9va3MoKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgcHJpc21hLmJvb2suZmluZE1hbnkoe1xyXG4gICAgICB3aGVyZToge1xyXG4gICAgICAgIGN1cnJlbnRRdWFudGl0eTogeyBndDogMCB9LFxyXG4gICAgICAgIGRlbGV0ZWRBdDogbnVsbFxyXG4gICAgICB9LFxyXG4gICAgICBvcmRlckJ5OiB7IHRpdGxlOiAnYXNjJyB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLy8gVmVyaWZpY2FyIHNlIGFsdW5vIHBvZGUgZW1wcmVzdGFyIHVtIGxpdnJvIGVzcGVjw61maWNvXHJcbiAgc3RhdGljIGFzeW5jIGNhblN0dWRlbnRCb3Jyb3dCb29rKHN0dWRlbnRJZDogc3RyaW5nLCBib29rSWQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgZXhpc3RpbmdMb2FuID0gYXdhaXQgcHJpc21hLmxvYW4uZmluZEZpcnN0KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBib29rSWQsXHJcbiAgICAgICAgc3R1ZGVudElkLFxyXG4gICAgICAgIHN0YXR1czogJ0FDVElWRSdcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICByZXR1cm4gIWV4aXN0aW5nTG9hblxyXG4gIH1cclxufSAiXSwibmFtZXMiOlsicHJpc21hIiwiQm9va1NlcnZpY2UiLCJMb2FuU2VydmljZSIsImdldEFsbExvYW5zIiwibG9hbiIsImZpbmRNYW55IiwiaW5jbHVkZSIsImJvb2siLCJzdHVkZW50Iiwib3JkZXJCeSIsImJvcnJvd2VkQXQiLCJnZXRMb2FuQnlJZCIsImlkIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiZ2V0TG9hbnNCeUZpbHRlcnMiLCJmaWx0ZXJzIiwic2VhcmNoIiwic3RhdHVzIiwicGVyaW9kIiwiZGF0ZUZpbHRlciIsIm9uZU1vbnRoQWdvIiwiRGF0ZSIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJndGUiLCJ0aHJlZU1vbnRoc0FnbyIsIm9uZVllYXJBZ28iLCJzZXRGdWxsWWVhciIsImdldEZ1bGxZZWFyIiwiQU5EIiwiT1IiLCJ0aXRsZSIsImNvbnRhaW5zIiwiY29kZSIsIm5hbWUiLCJjcmVhdGVMb2FuIiwiZGF0YSIsImJvb2tJZCIsIkVycm9yIiwiY3VycmVudFF1YW50aXR5IiwiZXhpc3RpbmdMb2FuIiwiZmluZEZpcnN0Iiwic3R1ZGVudElkIiwiY3JlYXRlIiwiaW5jcmVtZW50TG9hbnNDb3VudCIsInJldHVybkxvYW4iLCJ1cGRhdGUiLCJyZXR1cm5lZEF0IiwiZGVjcmVtZW50TG9hbnNDb3VudCIsImRlbGV0ZUxvYW4iLCJzZWxlY3QiLCJkZWxldGUiLCJnZXRMb2FuU3RhdHMiLCJ0b3RhbExvYW5zIiwiY291bnQiLCJhY3RpdmVMb2FucyIsInJldHVybmVkTG9hbnMiLCJvdmVyZHVlTG9hbnMiLCJkdWVEYXRlIiwibHQiLCJnZXRPdmVyZHVlTG9hbnMiLCJnZXRMb2Fuc0J5UGVyaW9kIiwic3RhcnREYXRlIiwiZ2V0QXZhaWxhYmxlQm9va3MiLCJndCIsImRlbGV0ZWRBdCIsImNhblN0dWRlbnRCb3Jyb3dCb29rIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/services/loans.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Floans%2Froute&page=%2Fapi%2Floans%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Floans%2Froute.ts&appDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMiguel%5Cprojetos%5Cbiblioteca&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();